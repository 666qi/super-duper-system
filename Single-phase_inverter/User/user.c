/*
 * user.c
 *
 *  Created on: 2025年11月11日
 *      Author: LW
 */


// --------------------------------------
// 头文件
// --------------------------------------
#include "F28x_Project.h"

// --------------------------------------
// 变量定义
// --------------------------------------



// --------------------------------------
// 函数定义
// --------------------------------------


// =============================================================================
/*******************************************************************************
 函数名称：   float32_t CalculateExecutionTime(uint32_t start_time, uint32_t end_time)
 功能描述：   计算代码执行时间（微秒级）
 输入参数：   start_time - 开始时间（定时器计数值）
           end_time   - 结束时间（定时器计数值）
 输出参数：   无
 返 回 值：  执行时间（微秒）
 其它说明：   a. 自动处理定时器溢出情况，适用于递减计数器
           b. 定时器配置为100MHz，每个计数周期=10ns
           c. 转换公式：微秒 = 计数值 × 10ns ÷ 1000ns/μs = 计数值 ÷ 100
 修改日期         版本号          修改人            修改内容
 -----------------------------------------------------------------------------
 2025/11/11    V1.0           LW              创建
********************************************************************************/
float32_t CalculateExecutionTime(uint32_t start_time, uint32_t end_time)
{
    float32_t elapsed_ticks;
    float32_t execution_time_us;

    // 处理计时器溢出情况
    if(end_time <= start_time)
    {
        // 未发生溢出（正常递减计数）
        elapsed_ticks = start_time - end_time;
    }
    else
    {
        // 发生定时器溢出
        elapsed_ticks = start_time + (10000000 - end_time); // PRD值为10,000,000
    }

    // 将计时器计数值转换为微秒(μs)
    // 定时器配置为100MHz CPU时钟，每个计数周期=10ns
    execution_time_us = (float32_t)elapsed_ticks / 100.0f;

    return execution_time_us;
}









// ---------------------------------
// End of File
// ---------------------------------

